# SOC-127: Zod v4 Monorepo Upgrade

| Field | Value |
|-------|-------|
| Epic | E01-dependency-upgrades |
| Project | P4-maintenance |
| Status | backlog |
| Priority | Medium |
| Story Points | 5 |
| Created | 2025-12-17 |
| Completed | - |

## Description

Upgrade Zod from v3 to v4 across all workspace packages simultaneously. This replaces Dependabot PR #14 which only upgraded the backend, causing version conflicts with shared and web packages.

## Acceptance Criteria

- [ ] Zod upgraded to v4 in @socio/backend
- [ ] Zod upgraded to v4 in @socio/web
- [ ] Zod upgraded to v4 in @socio/shared
- [ ] All validation schemas compile
- [ ] All tests pass
- [ ] No deprecated API warnings

## Technical Notes

### Packages to Update

```bash
pnpm add zod@^4.2.0 --filter @socio/backend
pnpm add zod@^4.2.0 --filter @socio/web
pnpm add zod@^4.2.0 --filter @socio/shared
```

### Breaking Changes to Address

1. **Deprecated string methods** (38 occurrences):
   - `z.string().email()` -> `z.email()`
   - `z.string().uuid()` -> `z.uuid()`
   - `z.string().url()` -> `z.url()`

2. **Error API change**:
   - `error.errors` -> `error.issues`

3. **UUID validation stricter** - RFC 4122 compliance enforced

### Files Requiring Updates

- apps/backend/src/config/env.validation.ts
- apps/backend/src/modules/auth/dto/auth.dto.ts
- apps/backend/src/modules/rooms/dto/rooms.dto.ts
- apps/backend/src/modules/messages/dto/messages.dto.ts
- And others using z.string().email/uuid/url patterns

### Optional Codemod

```bash
npx codemod zod/3/to-4
```

## Implementation Notes

Closed Dependabot PR: #14

## Related

- Parent Epic: E01-dependency-upgrades
- Blocks: None
- Blocked by: None
- PR: To be created

---

**AI Agent Prompt:**

```
Upgrade Zod to v4 across the monorepo:
1. Update zod in all package.json files (backend, web, shared)
2. Run pnpm install
3. Search for deprecated patterns: z.string().email/uuid/url
4. Update to new top-level functions: z.email/uuid/url
5. Update error.errors to error.issues
6. Run typecheck across all packages
7. Run tests
8. Create comprehensive upgrade PR
```
